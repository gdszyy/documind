# DocuMind v5: 标准化规范文档

## 1. 概述

DocuMind v5 是在 v4 基础上,通过对组件模板进行实战测试和优化,并引入后端层架构设计而演进的版本。它修复了 v4 模板在处理复杂组件时暴露出的不足,同时建立了完整的"服务+API"后端文档体系,使其更加完善和实用。

## 2. 核心变化 (v5 vs v4)

### 2.1. 组件模板的优化

v5 的组件模板在 v4 的基础上进行了以下关键优化:

| 编号 | 优化点 | 具体内容 | 解决的问题 |
|---|---|---|---|
| 1 | **状态矩阵增强** | 增加第三列"元素显隐说明" | 状态矩阵表格不够灵活 |
| 2 | **新增交互状态章节** | 增加"5.3. 交互状态"子章节 | 缺少"组件状态"章节 |
| 3 | **新增 Props 定义章节** | 增加"9.2. 组件 Props"子章节 | 缺少 Props 详细定义 |
| 4 | **新增使用示例章节** | 增加"7. 使用示例"章节 | "使用示例"章节缺失 |
| 5 | **调整内容指南位置** | 将"内容指南"移到"组件剖析"之后 | "内容指南"位置不当 |

### 2.2. 后端层架构设计 (v5 新增)

v5 引入了完整的后端文档体系,采用"**服务+API**"架构:

| 文档类型 | 职责 | 创建者 | 创建阶段 |
|---|---|---|---|
| **服务文档** | 业务逻辑、数据模型、核心方法 | 后端工程师 | 设计阶段 |
| **API 文档** | 接口契约、请求响应规格 | 后端工程师 | 设计阶段 |

**核心理念**:
- **服务是核心**: 服务文档包含业务逻辑、数据模型（内联）、状态机等完整信息
- **API 是接口**: API 文档只定义接口契约,业务逻辑引用服务文档
- **渐进式创建**: 产品经理创建服务占位符,后端工程师补充详细设计
- **按需详细**: 简单功能可以不创建独立服务文档,在 API 文档中内联说明

## 3. 文件与目录规范

### 3.1. 文件命名 (继承自 v3)

所有文档和资源文件名必须使用 **kebab-case** (小写字母,单词间用连字符 `-` 分隔)。

### 3.2. 目录结构 (v5 扩展)

```
docs/
├── standards/                   # 规范文档目录
│   ├── 00-specification-v5.md   # 本规范文档
│   ├── 01-figma-naming-convention.md
│   ├── 02-automation-workflow-guide.md
│   └── 04-repository-structure.md
├── templates/                   # 模板目录
│   ├── module-template.md
│   ├── page-template.md
│   ├── component-template.md
│   ├── service-template.md      # v5 新增
│   └── api-template.md          # v5 新增
├── architecture/                # v5 新增: 架构设计文档
│   └── service-api-architecture.md
├── examples/                    # v5 新增: 完整示例
│   └── wallet-deposit/
└── modules/
    └── {module-id}/
        ├── README.md
        ├── pages/
        ├── components/
        └── backend/             # v5 新增
            ├── services/        # 服务层
            └── apis/            # API 层
```

### 3.3. 后端层目录结构

```
backend/
├── services/                    # 服务层（核心）
│   ├── wallet-service.md        # 钱包服务
│   ├── deposit-service.md       # 充值服务
│   └── withdraw-service.md      # 提现服务
└── apis/                        # API 层（接口定义）
    ├── create-deposit.md        # 创建充值订单 API
    ├── get-balance.md           # 查询余额 API
    └── create-withdraw.md       # 创建提现订单 API
```

## 4. Front Matter 元数据

### 4.1. 通用必填字段 (继承自 v3)

| 字段 | 类型 | 描述 | 示例 |
|---|---|---|---|
| `id` | String | 文档唯一标识符 (kebab-case) | `deposit-service` |
| `type` | String | 文档类型 | `module`, `page`, `component`, `service`, `api` |
| `title` | String | 文档标题(中文) | `充值服务` |
| `status` | String | 文档状态 | `draft`, `in-design`, `in-progress`, `completed`, `outdated` |
| `createdAt` | String | 创建日期 (YYYY-MM-DD) | `2025-12-08` |
| `updatedAt` | String | 最后更新日期 (YYYY-MM-DD) | `2025-12-08` |

### 4.2. 服务文档特定字段 (v5 新增)

| 字段 | 类型 | 必填 | 描述 | 示例 |
|---|---|---|---|
| `stage` | String | 否 | 当前阶段 | `requirement`, `design`, `implementation` |
| `complexity` | String | 否 | 复杂度 | `simple`, `medium`, `complex` |

### 4.3. API 文档特定字段 (v5 新增)

| 字段 | 类型 | 必填 | 描述 | 示例 |
|---|---|---|---|
| `relatedService` | String | 是 | 所属服务的 ID | `deposit-service` |
| `method` | String | 是 | HTTP 方法 | `GET`, `POST`, `PUT`, `DELETE` |
| `path` | String | 是 | API 路径 | `/api/wallet/deposits` |

### 4.4. 组件特定字段 (继承自 v4)

| 字段 | 类型 | 必填 | 描述 |
|---|---|---|---|
| `componentType` | String | 是 | `normal` (普通) 或 `global` (全局) |
| `figmaUrl` | String | 否 | Figma 设计稿链接 |
| `hasInteractive` | Boolean | 否 | 是否有可交互 HTML 预览 |
| `interactiveUrl` | String | 否 | HTML 文件相对路径 |

## 5. 文档状态管理 (v5 新增)

### 5.1. 文档生命周期状态

| 状态 | 阶段 | 说明 | 负责人 |
|------|------|------|--------|
| `draft` | 需求阶段 | 草稿,产品经理创建 | 产品经理 |
| `in-design` | 设计阶段 | 后端架构设计中 | 后端工程师 |
| `in-progress` | 实现阶段 | 开发中 | 工程师 |
| `completed` | 已完成 | 与代码一致 | 工程师 |
| `outdated` | 已过期 | 需要更新 | - |

### 5.2. 状态转换规则

```
draft (需求) → in-design (设计) → in-progress (开发) → completed (完成)
                                                            ↓
                                                        outdated (过期)
                                                            ↓
                                                        in-progress (更新)
```

## 6. 渐进式文档创建流程 (v5 新增)

### 6.1. 需求阶段（产品经理）

**创建内容**:
- 模块文档
- 页面文档
- 组件文档
- **服务占位符**（在模块文档中列出需要的服务）

**示例**:
```markdown
## 需要的后端服务（占位符）
- 充值服务：处理用户充值业务
- 提现服务：处理用户提现业务
- 钱包服务：管理用户余额
```

### 6.2. 设计阶段（后端工程师）

**创建内容**:
1. **服务文档**（核心）：定义业务逻辑、数据模型、核心方法
2. **API 文档**（接口）：定义对外暴露的接口规格

**决策原则**:
- **简单功能**: 只创建 API 文档,业务逻辑内联
- **中等复杂度**: 创建 API 文档,在其中增加"业务逻辑"章节
- **复杂功能**: 创建服务文档 + API 文档

### 6.3. 实现阶段（开发工程师）

**工作内容**:
1. 根据服务文档实现代码
2. 使用自动化工具同步数据模型
3. 使用自动化工具校验 API 文档与代码的一致性
4. 更新文档状态为 `completed`

## 7. 内容语法规范 (继承自 v3)

### 7.1. 文档引用

- **标准语法**: `[@文档标题](相对路径)`
- **带标签语法**: `[@文档标题](相对路径) [标签]`

**示例**:
```markdown
详见 [@充值服务](../services/deposit-service.md)
使用 [@余额卡片](../components/balance-card.md) 组件
```

### 7.2. 可交互组件嵌入

使用 HTML 注释包裹 `<iframe>` 标签:

```markdown
<!-- INTERACTIVE_COMPONENT_START -->
<iframe src="./component-id.html" title="Interactive Preview" width="100%" height="400px" frameborder="0"></iframe>
<!-- INTERACTIVE_COMPONENT_END -->
```

## 8. 组件文档的标准章节结构 (v5 优化)

所有组件文档 **必须** 遵循以下 10 个章节的结构和顺序:

1. **Front Matter**: YAML 元数据
2. **1. 概述**: 组件描述
3. **2. 视觉预览**: 默认状态的预览图
4. **3. 组件剖析**: 构成元素及其功能
5. **4. 内容指南**: 各元素的内容规范
6. **5. 属性与状态**: 状态维度、状态矩阵、交互状态
7. **6. 行为与交互**: 用户操作、条件逻辑
8. **7. 使用示例**: 代码示例
9. **8. 无障碍设计**: 键盘导航、屏幕阅读器等
10. **9. 技术规格**: 关联关系、组件 Props、技术细节
11. **10. 变更历史**: 版本迭代记录

## 9. 服务文档的标准章节结构 (v5 新增)

所有服务文档 **必须** 遵循以下章节结构和顺序:

1. **Front Matter**: YAML 元数据
2. **1. 概述**: 服务职责和边界
3. **2. 业务规则**: 核心业务逻辑和约束条件
4. **3. 状态机**: 状态转换定义（如适用）
5. **4. 数据模型**: 服务使用的数据模型（内联定义）
6. **5. 核心方法**: 服务的核心方法和接口
7. **6. 暴露的 API**: 列出此服务暴露的所有 API
8. **7. 依赖关系**: 依赖的其他服务、外部 API
9. **8. 事务处理**: 事务策略和一致性保证
10. **9. 技术规格**: 技术栈、部署配置、安全性
11. **10. 变更历史**: 版本迭代记录

## 10. API 文档的标准章节结构 (v5 新增)

所有 API 文档 **必须** 遵循以下章节结构和顺序:

1. **Front Matter**: YAML 元数据
2. **1. 接口定义**: 请求方法、路径、所属服务
3. **2. 请求参数**: 参数列表和说明
4. **3. 响应数据**: 成功响应和错误响应
5. **4. 错误码**: 错误码定义
6. **5. 业务逻辑**: 引用所属服务文档
7. **6. 示例**: 请求和响应示例
8. **7. 变更历史**: 版本迭代记录

## 11. 自动化工作流规范 (继承自 v4)

### 11.1. Figma 命名规范

详见 [Figma 命名规范指南](./01-figma-naming-convention.md)。

### 11.2. 数据提取格式

从 Figma 提取的数据应遵循 [自动化工作流指南](./02-automation-workflow-guide.md) 中定义的 JSON 格式。

### 11.3. AI 生成指南

AI 应遵循 [自动化工作流指南](./02-automation-workflow-guide.md) 中的"主提示词"来生成符合规范的文档。

## 12. 向后兼容性

v5 完全兼容 v4 和 v3 的所有规范。现有的 v3/v4 文档无需修改,可以直接在 v5 体系中使用。如果需要升级到新的组件模板,只需按照 v5 的章节结构重新组织内容即可。

## 13. 变更历史

| 日期 | 版本 | 变更内容 | 变更人 |
|---|---|---|---|
| 2025-12-08 | v5.1.0 | 引入后端层架构设计,建立"服务+API"文档体系 | @manus-ai |
| 2025-12-08 | v5.0.0 | 优化组件模板,增强对复杂组件的支持 | @manus-ai |
| 2025-12-08 | v4.0.0 | 整合 Figma 组件系统,引入自动化工作流 | @manus-ai |
| 2025-12-08 | v3.0.0 | 初始版本,基于前端解析规范 | @manus-ai |
