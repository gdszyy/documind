# 比赛展示策略方案

本目录包含了完整的体育赛事前端展示与后端分发策略方案。

## 文档结构

### 01-complete-strategy.md - 完整策略方案
完整的技术方案，包含：
- 问题背景与用户需求分析
- 核心概念与技术基础（订阅状态、比赛状态、盘口状态、交接机制）
- 核心展示策略矩阵
- 交接阶段的特殊处理
- 后端实现指南（数据库设计、消息处理、API 设计）
- 前端实现指南（渲染逻辑、实时更新、CSS 样式）
- 监控与告警方案
- 测试建议

### 02-fallback-logic.md - 兜底逻辑补充方案
针对比赛状态判断的兜底逻辑，解决消息延迟或丢失的问题：
- 比赛结束判断的兜底逻辑（订阅了 liveodds）
- 比赛开赛判断的兜底逻辑（未订阅 liveodds）
- 多维度交叉验证（官方状态、时间、比分、盘口）
- 定期检查任务
- 监控告警

### 03-deactivated-markets.md - 盘口停用场景补充方案
处理盘口全部停用的极端场景：
- 可用盘口的重新定义（status in 1, -1, -2）
- "曾有盘口"判断维度
- 展示策略矩阵更新
- 数据库字段补充
- 前端展示优化

### 04-final-matrix.md - 最终策略矩阵总结
完整的策略矩阵总结，包含：
- 14种场景的完整矩阵
- 决策流程图
- 实现检查清单
- 配置参数
- 快速参考

## 核心解决方案

### 关键策略

**对于订阅了 liveodds 的比赛**：
- ✅ 只要比赛未结束（not_started 或 live），就应该展示
- ✅ 即使在交接阶段没有可用盘口，也要继续展示
- ✅ 即使盘口全部停用，只要曾经有过可用盘口，也要继续展示

**对于未订阅 liveodds 的比赛**：
- ✅ 只在赛前且（有可用盘口 或 曾有可用盘口）时展示
- ❌ 开赛后不展示（因为没有滚球数据）
- ❌ 从未有过可用盘口时不展示

### 可用盘口的定义

**可用盘口** = 所有可以转换为 Active 的状态：
- `1` (Active)：活跃，可投注
- `-1` (Suspended)：暂停，但可能恢复
- `-2` (Handed Over)：交接中，会转换为 Active

**不可用盘口** = 永久性停用的状态：
- `0` (Deactivated)：停用，不会再恢复
- `-3` (Settled)：已结算
- `-4` (Cancelled)：已取消

### 关键场景

1. **交接阶段**：订阅滚球的比赛在交接时继续展示，提示"盘口准备中..."
2. **盘口停用**：曾有盘口的比赛即使停用也继续展示，提示"暂无可用盘口"
3. **状态兜底**：多维度交叉验证，不完全依赖单一数据源

## 图片资源

- `logic_flowchart.png` - 逻辑流程图
- `user_requirement_chart.png` - 用户需求图表

## 版本历史

| 版本 | 日期 | 说明 |
| :--- | :--- | :--- |
| 1.0 | 2025-12-09 | 初始版本，完整的展示策略方案 |
| 1.1 | 2025-12-09 | 补充兜底逻辑方案 |
| 1.2 | 2025-12-09 | 补充盘口停用场景方案 |
| 2.0 | 2025-12-09 | 最终完整策略矩阵 |

## 相关文档

- [Sportradar UOF 实时层消息处理规范](../01-uof-realtime-layer.md)
- [Sportradar 消息处理与 Market 状态流转分析](../06-message-processing-market-state.md)
- [Sportradar sport_event_status 元素完整指南](../07-sport-event-status-guide.md)
