stateDiagram-v2
    [*] --> Active: 新市场创建

    Active --> Suspended: odds_change(status=-1)<br/>或 bet_stop
    Active --> Deactivated: odds_change(status=0)
    Active --> Settled: bet_settlement
    Active --> Cancelled: bet_cancel
    Active --> HandedOver: odds_change(status=-2)

    Suspended --> Active: odds_change(status=1)
    Suspended --> Deactivated: odds_change(status=0)
    Suspended --> Settled: bet_settlement
    Suspended --> Cancelled: bet_cancel

    Deactivated --> Active: odds_change(status=1)
    Deactivated --> Suspended: odds_change(status=-1)
    Deactivated --> Settled: bet_settlement
    Deactivated --> Cancelled: bet_cancel

    Settled --> Active: rollback_bet_settlement<br/>(极少数情况)
    Settled --> Cancelled: bet_cancel<br/>(极少数情况)

    HandedOver --> Active: odds_change(status=1)<br/>来自新生产者
    HandedOver --> Suspended: 60秒无更新<br/>自动暂停

    Cancelled --> [*]: 终态

    note right of Active
        投注可用
        赔率实时更新
    end note

    note right of Suspended
        投注暂停
        赔率继续更新
        通常为秒级状态
    end note

    note right of Deactivated
        投注不可用
        不提供赔率
        可恢复为活跃
    end note

    note right of Settled
        投注已结算
        不再提供赔率
        极少可被回滚
    end note

    note right of Cancelled
        市场已取消
        投注作废
        无法恢复
    end note

    note right of HandedOver
        生产者交接状态
        应暂停投注
        等待新生产者赔率
    end note
