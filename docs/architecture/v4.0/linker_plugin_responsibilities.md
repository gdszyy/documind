
# Linker 浏览器插件：核心职责定义 (v4.0)

## 一、核心定位：轻量级的“阅读器”与“链接器”

在 v4.0 架构中，Linker 插件的职责被大幅简化，回归其最纯粹、最核心的价值。它不再是一个臃肿的“迷你应用”，而是一个轻量、专注、高性能的浏览器助手。

- **核心职责**: 阅读、引用
- **用户角色**: 普通用户、文档撰写者
- **设计哲学**: **“Do One Thing and Do It Well”** (只做一件事，并把它做到极致)。

---

## 二、核心功能清单 (MVP)

Linker 插件的 MVP 功能应严格限制在以下两个核心场景：

### 1. `@` 引用 (自动补全)

- **触发**: 监听用户在飞书文档中输入 `@` 字符。
- **行为**: 
    1. 触发后，立即调用后台 API：`GET /api/entities/search?q={keyword}`。
    2. 将返回的实体列表，以一个简洁、高效的下拉菜单形式展示给用户。
    3. 列表项应至少包含**实体名称**和**实体类型**。
    4. 用户通过键盘上下选择或鼠标点击，选中一个实体。
- **结果**: 在当前光标位置，插入一个“智能链接”。该链接的文本为实体名称，并包含一个特殊的 `data-` 属性，用于存储实体 ID，例如：
  ```html
  <a href="{后台返回的飞书文档URL}" data-entity-id="{实体ID}">@用户服务</a>
  ```

### 2. 悬停预览 (Hover Preview)

- **触发**: 监听用户鼠标悬停在“智能链接”上（通过检测 `data-entity-id` 属性来识别）。
- **行为**: 
    1. 触发后，立即调用后台 API：`GET /api/entities/:id`。
    2. 将返回的实体详细信息，以一个美观、信息密度高的浮动卡片（Tooltip/Popover）形式展示出来。
- **卡片内容**: 
    - **必须包含**: 实体名称、实体类型、状态、负责人、简短描述。
    - **可以包含**: 指向 Web 管理后台详情页的“查看更多”链接。

---

## 三、明确“不做”的功能 (Out of Scope for MVP)

为了确保插件的轻量和快速交付，以下功能**不应该**在 Linker 插件中实现：

- **❌ 实体创建/编辑**: 所有创建和编辑操作都在 **Web 管理后台** 进行。插件中最多可以提供一个指向 Web 后台创建页面的快捷链接。
- **❌ 知识图谱可视化**: 复杂的图谱可视化在 Web 管理后台实现。
- **❌ AI 问答**: AI 问答界面在 Web 管理后台实现。
- **❌ 复杂的设置界面**: 插件的设置项应保持最简，高级配置在 Web 管理后台进行。

---

## 四、技术要点

- **性能优先**: 插件必须对飞书文档的性能影响降到最低。所有 API 调用都应是异步的，并有合理的超时和缓存机制。
- **DOM 交互**: 插件的核心技术难点在于与飞书编辑器（一个复杂的富文本编辑器）的 DOM 进行交互。需要 Agent 0-3 (前端监控工程师) 提供持续的 DOM 结构分析和变更告警。
- **安全性**: 所有对后台 API 的调用都必须携带认证凭证（如 API Key 或 Token）。

---

## 五、对应的 Agent 任务 (Agent 1-1)

**Agent 1-1: Linker 插件开发者 (v4.0 更新版)**

- **角色**: 浏览器插件开发者
- **核心技能**: 精通 JavaScript/TypeScript，熟悉浏览器插件开发 API，有处理复杂 DOM 交互的经验。
- **核心任务**: 
    1. 实现 `@` 搜索补全功能。
    2. 实现悬停预览功能。
    3. 与 Agent 1-3 (后端 API 开发者) 协作，完成 API 的联调。
    4. 与 Agent 0-3 (前端监控工程师) 协作，确保插件对飞书 DOM 的兼容性。
