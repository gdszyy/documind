# Documind Web 前端需求迭代计划

本文档旨在将用户提出的所有新需求进行汇总，并制定详细的分期迭代计划，以确保功能能够有序、高效地开发和交付。

## 需求汇总

根据用户的输入，我们将所有需求整理如下：

| 需求 ID | 需求描述 |
|---|---|
| 1 | 左侧导航栏支持暂时隐藏，以优化小屏幕或内容专注场景下的显示效果。 |
| 2 | 在“实体列表”页面增加一个明确的按钮，用于一键跳转到“知识图谱”页面。 |
| 3 | 在“实体列表”页面的每一行操作区增加“查看文档”按钮，点击后在页面左侧以内嵌框架（IFrame）的形式展示该实体关联的飞书文档。 |
| 4 | 移除“知识图谱”中点击实体节点后弹出的详情侧边栏的背景蒙版，以允许用户在查看详情的同时与图谱进行交互。 |
| 5 | 修复“知识图谱”详情侧边栏中存在两个关闭（“X”）按钮的 UI 缺陷，只保留一个功能正常的关闭按钮。 |
| 6 | 在“知识图谱”的详情侧边栏和“实体编辑”页面中，增加显示该实体在知识图谱中的所有双向关联关系，而不仅仅是单向关系。 |

## 迭代分期计划

为了实现敏捷开发和快速交付，我们将上述需求以及新增的布局优化需求，分为四个迭代周期进行。每个周期都包含一组功能上关联或优先级相近的需求。

### 第一期：知识图谱布局优化

本阶段的核心目标是解决当前知识图谱布局混乱、可读性差的问题。我们将引入自动布局算法，从根本上提升图谱的可视化效果。

- **新增需求：优化知识图谱布局**
  - **实现方案**：集成 `Dagre.js` 布局库。在 `Graph.tsx` 组件中，当从后端获取到节点和边的数据后，使用 `Dagre.js` 计算出每个节点的最优位置，然后再将这些位置信息传递给 `ReactFlow` 组件进行渲染。这将取代当前的静态网格布局逻辑，实现自动化、层级化的布局。
  - **影响文件**：`backend/client/src/pages/Graph.tsx`
  - **依赖安装**：`pnpm add dagre @types/dagre`

### 第二期：导航优化和基础跳转

本阶段专注于优化应用的基础导航体验，解决两个最直接的易用性问题。

- **需求 #1：隐藏左侧导航**
  - **实现方案**：在 `DashboardLayout.tsx` 组件中，利用现有的 `SidebarProvider` 和 `useSidebar` hook，实现一个可以切换侧边栏可见性的按钮。由于当前侧边栏已经支持展开和折叠（collapsible），我们可以扩展此功能为完全隐藏，或者将折叠状态视为“隐藏”。
  - **影响文件**：`backend/client/src/components/DashboardLayout.tsx`

- **需求 #2：实体列表跳转至知识图谱**
  - **实现方案**：在 `Entities.tsx` 页面的工具栏区域，仿照“创建新实体”按钮，增加一个“知识图谱”按钮，并使用 `wouter` 的 `Link` 组件包裹，使其导航至 `/graph` 路径。
  - **影响文件**：`backend/client/src/pages/Entities.tsx`

### 第三期：侧边栏优化和文档查看

本阶段主要处理与侧边栏相关的 UI/UX 问题，并引入内嵌文档查看功能。

- **需求 #4：移除详情侧边栏蒙版**
  - **实现方案**：在 `Graph.tsx` 页面中，检查 `<Sheet>` 组件（来自 `shadcn/ui`）的属性。蒙版（Overlay）通常是该组件的默认行为。我们需要通过设置相应属性（如 `modal={false}` 或修改样式）来禁用它。
  - **影响文件**：`backend/client/src/pages/Graph.tsx`

- **需求 #5：修复重复的关闭按钮**
  - **实现方案**：在 `Graph.tsx` 的 `<SheetContent>` 中，存在一个自定义的关闭按钮和一个可能由 `<Sheet>` 组件自动生成的关闭按钮。需要移除自定义的那个，或配置 `<Sheet>` 不显示默认的关闭按钮。
  - **影响文件**：`backend/client/src/pages/Graph.tsx`

- **需求 #3：实体列表内嵌查看文档**
  - **实现方案**：这将是一个相对复杂的功能。我们需要在 `Entities.tsx` 中：
    1.  增加一个新的状态来管理当前要显示的文档 URL 和内嵌框架的可见性。
    2.  在表格的“操作”列为每个实体添加一个“查看文档”按钮。
    3.  点击按钮时，更新状态，将对应的 `larkDocUrl` 传入，并显示一个占据页面左侧的 `<iframe>` 容器。
    4.  可能需要调整整体页面布局，以容纳这个新的内嵌视图。
  - **影响文件**：`backend/client/src/pages/Entities.tsx`

### 第四期：双向关系展示

本阶段专注于最后一个核心功能，即在多个视图中完整地展示实体的关联关系。

- **需求 #6：显示双向关系**
  - **实现方案**：
    1.  **后端 API**：首先需要确认 `trpc.entities.getRelationships` 这个 tRPC 接口是否返回了双向关系（包括“传入”和“传出”的关联）。如果目前只返回单向，则需要修改后端逻辑。
    2.  **知识图谱侧边栏**：在 `Graph.tsx` 的详情侧边栏中，目前只渲染了 `relationships.outgoing`。我们需要增加对 `relationships.incoming`（或类似字段）的渲染，清晰地展示“依赖于此实体的”和“此实体依赖的”两种关系。
    3.  **实体编辑页面**：在 `EntityForm.tsx` 页面中，同样调用 `trpc.entities.getRelationships` 接口，并在页面上渲染这些双向关系。这可以作为一个新的卡片（Card）组件来实现。
  - **影响文件**：`backend/client/src/pages/Graph.tsx`, `backend/client/src/pages/EntityForm.tsx`, 以及可能涉及的后端 tRPC 路由文件。

## 下一步行动

我们将从第一期【知识图谱布局优化】开始，逐一完成开发、测试，并向您汇报进度。
